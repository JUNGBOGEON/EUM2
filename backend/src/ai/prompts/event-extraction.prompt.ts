/**
 * 회의 녹취록에서 시간 표현을 추출하기 위한 AI 프롬프트
 *
 * @param currentDate 현재 날짜 (YYYY-MM-DD 형식, KST)
 * @param currentTime 현재 시간 (HH:mm 형식, KST)
 * @param currentDayOfWeek 현재 요일 (예: "월요일", "화요일")
 * @returns AI 프롬프트 문자열
 */
export const getEventExtractionPrompt = (
  currentDate: string,
  currentTime: string,
  currentDayOfWeek: string,
): string => {
  // 날짜 파싱하여 계산에 사용
  const [year, month, day] = currentDate.split('-').map(Number);

  // 상대 날짜 계산 헬퍼
  const addDays = (days: number): string => {
    const date = new Date(Date.UTC(year, month - 1, day + days));
    return date.toISOString().split('T')[0];
  };

  const tomorrow = addDays(1);
  const dayAfterTomorrow = addDays(2);
  const threeDaysLater = addDays(3);

  return `
당신은 회의 녹취록에서 일정 관련 시간 표현을 추출하는 전문 AI입니다.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[현재 시각 - 매우 중요! 모든 날짜 계산의 기준]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
- 오늘 날짜: ${currentDate} (${currentDayOfWeek})
- 현재 시각: ${currentTime} (한국 표준시, KST, UTC+9)
- 현재 연도: ${year}년

[상대 날짜 기준값 - 반드시 이 값을 사용하세요]
- "오늘" = ${currentDate}
- "내일" = ${tomorrow}
- "모레" = ${dayAfterTomorrow}
- "글피" = ${threeDaysLater}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[Few-shot 예시 - 날짜 변환 방법]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

예시 1: 상대적 날짜 표현
- 입력: [ID:abc123][김철수]: 그럼 내일 오후 3시에 회의하죠
- 오늘이 ${currentDate}이므로, "내일"은 ${tomorrow}입니다.
- 결과: normalizedDateTime = "${tomorrow}T15:00:00+09:00"

예시 2: "오늘" 표현
- 입력: [ID:def456][이영희]: 오늘 저녁까지 문서 보내드릴게요
- 오늘이 ${currentDate}이므로, "오늘"은 ${currentDate}입니다.
- 결과: normalizedDateTime = "${currentDate}T18:00:00+09:00"

예시 3: 절대적 날짜 표현 (월/일)
- 입력: [ID:ghi789][박지민]: 1월 20일에 마감입니다
- 현재 연도 ${year}년을 적용합니다.
- 결과: normalizedDateTime = "${year}-01-20T09:00:00+09:00"

예시 4: "모레" 표현
- 입력: [ID:jkl012][정수민]: 모레까지 작업 완료하겠습니다
- 오늘이 ${currentDate}이므로, "모레"는 ${dayAfterTomorrow}입니다.
- 결과: normalizedDateTime = "${dayAfterTomorrow}T09:00:00+09:00"

예시 5: 요일 표현 (이번 주)
- 입력: [ID:mno345][최영수]: 이번 주 금요일에 발표합시다
- 오늘이 ${currentDayOfWeek}(${currentDate})입니다.
- "이번 주 금요일"은 오늘 기준 가장 가까운 금요일입니다.
- 만약 오늘이 이미 금요일이거나 지났다면, 다음 주 금요일로 계산합니다.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[추출 대상 시간 표현]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. 상대적 표현: 오늘, 내일, 모레, 글피, 다음 주, 이번 주 금요일
2. 절대적 표현: 1월 15일, 2월 말, 3월 첫째 주
3. 시간 표현: 오전 10시, 오후 2시, 4시부터 6시까지, 점심 후
4. 기간 표현: ~까지, ~전에, ~이내에

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[변환 규칙 - 반드시 준수]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
상대 날짜 (오늘 ${currentDate} 기준):
- "오늘" → ${currentDate}
- "내일" → ${tomorrow}
- "모레" → ${dayAfterTomorrow}
- "글피" → ${threeDaysLater}

시간 기본값:
- 시간 미지정 시 → 09:00 기본값
- "점심 후", "오후 초" → 13:00
- "오전 중" → 10:00
- "오후 중" → 15:00
- "저녁" → 18:00
- "밤" → 21:00

요일 계산:
- 오늘은 ${currentDayOfWeek}입니다.
- "이번 주 X요일" → 현재 주의 해당 요일 (이미 지났으면 다음 주)
- "다음 주 X요일" → 다음 주의 해당 요일

연도 규칙:
- 연도 미지정 시 → ${year}년 사용
- 만약 지정된 월/일이 오늘보다 과거라면 → ${year + 1}년 사용

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[이벤트 유형 분류]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
- meeting: "회의", "미팅", "논의", "회의하죠", "미팅합시다"
- deadline: "까지", "마감", "제출", "완료해주세요", "끝내다"
- reminder: "확인", "체크", "리마인더", "알려주세요"
- task: "작업", "진행", "하겠습니다", "할게요", "개발", "구현"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[confidence 점수 기준]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
- 0.9~1.0: 명확한 날짜+시간 ("내일 오후 3시", "1월 15일 오전 10시")
- 0.7~0.9: 명확한 날짜, 시간 추정 ("내일", "모레 점심")
- 0.5~0.7: 애매한 표현 ("이번 주 중", "곧")
- 0.5 미만: 추출 제외 → ambiguousExpressions에 기록

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[입력 형식]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
각 발화에는 ID가 포함됩니다:
[ID:result-abc123][화자이름]: 발화 내용

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[출력 형식 - JSON만 출력]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
반드시 아래 JSON 형식만 출력하세요. 설명이나 부가 텍스트 없이 JSON만:

{
  "events": [
    {
      "title": "간결한 이벤트 제목 (10자 이내)",
      "description": "관련 발화 요약",
      "timeExpression": {
        "originalText": "원본에서 추출한 시간 표현 (예: 내일 오후 3시)",
        "normalizedDateTime": "YYYY-MM-DDTHH:mm:ss+09:00",
        "endDateTime": "YYYY-MM-DDTHH:mm:ss+09:00 또는 null",
        "isAllDay": false,
        "confidence": 0.9
      },
      "eventType": "meeting|deadline|reminder|task",
      "assignee": "담당자 또는 null",
      "transcriptRefIds": ["발화 ID 배열"],
      "speakerName": "발화자"
    }
  ],
  "ambiguousExpressions": [
    {
      "text": "애매한 시간 표현",
      "reason": "애매한 이유",
      "suggestedInterpretation": "가능한 해석"
    }
  ]
}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[중요 규칙]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. 모든 상대 날짜는 오늘(${currentDate}) 기준으로 계산합니다
2. "내일"은 반드시 ${tomorrow}입니다 - 다른 날짜로 변환하지 마세요
3. "오늘"은 반드시 ${currentDate}입니다
4. 과거 시간 표현은 무시합니다 (예: "어제 했던", "지난주에")
5. 시간 표현이 없으면: {"events": [], "ambiguousExpressions": []}
6. 모든 시간은 한국 시간(KST, +09:00)으로 출력합니다

이제 아래 회의 녹취록에서 일정 관련 시간 표현을 추출해주세요:
`;
};

/**
 * 시스템 프롬프트 (모델 설정용)
 */
export const EVENT_EXTRACTION_SYSTEM_PROMPT = `
당신은 한국어 회의 녹취록을 분석하여 일정 관련 정보를 추출하는 전문 AI 어시스턴트입니다.

핵심 역할:
1. 시간 표현을 정확하게 인식하고 ISO 8601 형식으로 변환
2. 상대적 날짜 표현(오늘, 내일, 모레)을 제공된 기준 날짜로 정확히 변환
3. 이벤트 유형을 적절히 분류 (meeting, deadline, reminder, task)
4. 발화자와 담당자를 구분하여 기록
5. 신뢰도 점수를 객관적으로 평가

중요 - 날짜 계산:
- 프롬프트에 제공된 "오늘 날짜"와 "상대 날짜 기준값"을 반드시 사용하세요
- "내일"이라고 하면 프롬프트에 명시된 내일 날짜를 그대로 사용하세요
- 임의로 날짜를 계산하지 마세요 - 제공된 값만 사용하세요

출력 형식:
- 반드시 유효한 JSON만 출력
- 추가 설명이나 마크다운 없이 JSON 객체만 반환
- 모든 필드명은 camelCase 사용

주의사항:
- 과거 시제의 시간 표현은 무시
- 불확실한 표현은 낮은 confidence 점수 부여
- 컨텍스트를 고려하여 이벤트 유형 결정
`.trim();
